import { createContext, useContext, useState, useCallback, ReactNode } from "react";

export type Language = "en" | "fr" | "ar" | "es";

export const LANGUAGES: { code: Language; label: string; dir: "ltr" | "rtl" }[] = [
  { code: "en", label: "English", dir: "ltr" },
  { code: "fr", label: "Français", dir: "ltr" },
  { code: "ar", label: "العربية", dir: "rtl" },
  { code: "es", label: "Español", dir: "ltr" },
];

const translations: Record<Language, Record<string, string>> = {
  en: {
    "nav.agents": "Agents",
    "nav.admin": "Admin",
    "nav.profile": "Profile",
    "nav.settings": "Settings",
    "app.title": "Agent Portal",
    "app.subtitle": "AI Command Center",
    "agents.title": "Your Agents",
    "agents.subtitle": "Select a specialist to start a conversation",
    "agents.search": "Search agents...",
    "agents.noResults": "No agents found matching",
    "agents.noAgents": "No agents available. Ask an admin to assign agents to you.",
    "agents.online": "Online",
    "agents.offline": "Offline",
    "agents.maintenance": "Maintenance",
    "admin.title": "Admin Panel",
    "admin.subtitle": "Manage agents, endpoints, and access control",
    "admin.newAgent": "New Agent",
    "admin.editAgent": "Edit Agent",
    "admin.createAgent": "Create New Agent",
    "admin.name": "Name",
    "admin.category": "Category",
    "admin.endpoint": "Endpoint URL",
    "admin.description": "Description",
    "admin.icon": "Icon",
    "admin.status": "Status",
    "admin.actions": "Actions",
    "admin.agent": "Agent",
    "admin.save": "Update",
    "admin.create": "Create",
    "admin.cancel": "Cancel",
    "admin.agentUpdated": "Agent updated",
    "admin.agentCreated": "Agent created",
    "admin.agentDeleted": "Agent deleted",
    "admin.noAgents": "No agents yet. Create one to get started.",
    "admin.missingFields": "Missing fields",
    "admin.missingFieldsDesc": "Name and endpoint are required.",
    "admin.namePlaceholder": "Agent name",
    "admin.categoryPlaceholder": "e.g. Analytics",
    "admin.endpointPlaceholder": "https://api.example.com/agents/...",
    "admin.descriptionPlaceholder": "What does this agent do?",
    "admin.assignmentNote": "User assignment",
    "admin.assignmentNoteDesc": "User assignment via email lookup coming soon.",
    "auth.signIn": "Sign In",
    "auth.signUp": "Sign Up",
    "auth.signOut": "Sign Out",
    "auth.signInDesc": "Welcome back to the AI Command Center",
    "auth.signUpDesc": "Create your account to get started",
    "auth.email": "Email address",
    "auth.password": "Password",
    "auth.displayName": "Display name",
    "auth.noAccount": "Don't have an account? Sign up",
    "auth.hasAccount": "Already have an account? Sign in",
    "auth.error": "Authentication error",
    "auth.checkEmail": "Check your email",
    "auth.checkEmailDesc": "We sent you a confirmation link. Please verify your email.",
    "profile.title": "Profile",
    "profile.subtitle": "Manage your personal information",
    "profile.displayName": "Display Name",
    "profile.bio": "Bio",
    "profile.save": "Save Changes",
    "profile.saved": "Profile saved",
    "profile.saveError": "Failed to save profile",
    "profile.uploadError": "Failed to upload avatar",
    "settings.title": "Settings",
    "settings.subtitle": "Configure your preferences",
    "settings.language": "Language",
    "settings.theme": "Theme",
    "settings.notifications": "Notifications",
    "settings.notificationsDesc": "Receive email notifications",
    "settings.saved": "Settings saved",
    "chat.placeholder": "Type your message...",
    "chat.welcome": "Hello! I'm **{name}**. How can I assist you today?",
    "chat.simulated": 'I\'ve received your query: "{query}". This is a simulated response. Connect a real endpoint in the Admin panel to get live responses.',
    "chat.thinking": "Thinking...",
    "chat.voiceMessage": "Voice message",
    "chat.recording": "Recording...",
    "chat.uploadImage": "Upload image",
    "chat.uploadFile": "Attach file",
    "chat.voiceRecord": "Record voice",
    "notfound.title": "404",
    "notfound.text": "Oops! Page not found",
    "notfound.link": "Return to Home",
    "user.name": "User",
    "user.email": "user@company.com",
  },
  fr: {
    "nav.agents": "Agents",
    "nav.admin": "Admin",
    "nav.profile": "Profil",
    "nav.settings": "Paramètres",
    "app.title": "Portail Agent",
    "app.subtitle": "Centre de Commande IA",
    "agents.title": "Vos Agents",
    "agents.subtitle": "Sélectionnez un spécialiste pour démarrer une conversation",
    "agents.search": "Rechercher des agents...",
    "agents.noResults": "Aucun agent trouvé correspondant à",
    "agents.noAgents": "Aucun agent disponible. Demandez à un admin de vous assigner des agents.",
    "agents.online": "En ligne",
    "agents.offline": "Hors ligne",
    "agents.maintenance": "Maintenance",
    "admin.title": "Panneau Admin",
    "admin.subtitle": "Gérer les agents, endpoints et contrôle d'accès",
    "admin.newAgent": "Nouvel Agent",
    "admin.editAgent": "Modifier l'Agent",
    "admin.createAgent": "Créer un Nouvel Agent",
    "admin.name": "Nom",
    "admin.category": "Catégorie",
    "admin.endpoint": "URL de l'Endpoint",
    "admin.description": "Description",
    "admin.icon": "Icône",
    "admin.status": "Statut",
    "admin.actions": "Actions",
    "admin.agent": "Agent",
    "admin.save": "Mettre à jour",
    "admin.create": "Créer",
    "admin.cancel": "Annuler",
    "admin.agentUpdated": "Agent mis à jour",
    "admin.agentCreated": "Agent créé",
    "admin.agentDeleted": "Agent supprimé",
    "admin.noAgents": "Aucun agent encore. Créez-en un pour commencer.",
    "admin.missingFields": "Champs manquants",
    "admin.missingFieldsDesc": "Le nom et l'endpoint sont requis.",
    "admin.namePlaceholder": "Nom de l'agent",
    "admin.categoryPlaceholder": "ex. Analytique",
    "admin.endpointPlaceholder": "https://api.example.com/agents/...",
    "admin.descriptionPlaceholder": "Que fait cet agent ?",
    "admin.assignmentNote": "Attribution utilisateur",
    "admin.assignmentNoteDesc": "Attribution par email bientôt disponible.",
    "auth.signIn": "Se connecter",
    "auth.signUp": "S'inscrire",
    "auth.signOut": "Se déconnecter",
    "auth.signInDesc": "Bienvenue au Centre de Commande IA",
    "auth.signUpDesc": "Créez votre compte pour commencer",
    "auth.email": "Adresse email",
    "auth.password": "Mot de passe",
    "auth.displayName": "Nom d'affichage",
    "auth.noAccount": "Pas de compte ? Inscrivez-vous",
    "auth.hasAccount": "Déjà un compte ? Connectez-vous",
    "auth.error": "Erreur d'authentification",
    "auth.checkEmail": "Vérifiez votre email",
    "auth.checkEmailDesc": "Nous vous avons envoyé un lien de confirmation.",
    "profile.title": "Profil",
    "profile.subtitle": "Gérez vos informations personnelles",
    "profile.displayName": "Nom d'affichage",
    "profile.bio": "Bio",
    "profile.save": "Enregistrer",
    "profile.saved": "Profil enregistré",
    "profile.saveError": "Échec de l'enregistrement",
    "profile.uploadError": "Échec du téléchargement de l'avatar",
    "settings.title": "Paramètres",
    "settings.subtitle": "Configurez vos préférences",
    "settings.language": "Langue",
    "settings.theme": "Thème",
    "settings.notifications": "Notifications",
    "settings.notificationsDesc": "Recevoir des notifications par email",
    "settings.saved": "Paramètres enregistrés",
    "chat.placeholder": "Tapez votre message...",
    "chat.welcome": "Bonjour ! Je suis **{name}**. Comment puis-je vous aider ?",
    "chat.simulated": 'J\'ai reçu votre requête : "{query}". Ceci est une réponse simulée.',
    "chat.thinking": "Réflexion...",
    "chat.voiceMessage": "Message vocal",
    "chat.recording": "Enregistrement...",
    "chat.uploadImage": "Télécharger une image",
    "chat.uploadFile": "Joindre un fichier",
    "chat.voiceRecord": "Enregistrer la voix",
    "notfound.title": "404",
    "notfound.text": "Oops ! Page non trouvée",
    "notfound.link": "Retour à l'Accueil",
    "user.name": "Utilisateur",
    "user.email": "utilisateur@entreprise.com",
  },
  ar: {
    "nav.agents": "الوكلاء",
    "nav.admin": "الإدارة",
    "nav.profile": "الملف الشخصي",
    "nav.settings": "الإعدادات",
    "app.title": "بوابة الوكيل",
    "app.subtitle": "مركز قيادة الذكاء الاصطناعي",
    "agents.title": "وكلاؤك",
    "agents.subtitle": "اختر متخصصًا لبدء محادثة",
    "agents.search": "البحث عن وكلاء...",
    "agents.noResults": "لم يتم العثور على وكلاء مطابقين",
    "agents.noAgents": "لا يوجد وكلاء. اطلب من المشرف تعيين وكلاء لك.",
    "agents.online": "متصل",
    "agents.offline": "غير متصل",
    "agents.maintenance": "صيانة",
    "admin.title": "لوحة الإدارة",
    "admin.subtitle": "إدارة الوكلاء ونقاط النهاية والتحكم في الوصول",
    "admin.newAgent": "وكيل جديد",
    "admin.editAgent": "تعديل الوكيل",
    "admin.createAgent": "إنشاء وكيل جديد",
    "admin.name": "الاسم",
    "admin.category": "الفئة",
    "admin.endpoint": "رابط نقطة النهاية",
    "admin.description": "الوصف",
    "admin.icon": "الأيقونة",
    "admin.status": "الحالة",
    "admin.actions": "الإجراءات",
    "admin.agent": "الوكيل",
    "admin.save": "تحديث",
    "admin.create": "إنشاء",
    "admin.cancel": "إلغاء",
    "admin.agentUpdated": "تم تحديث الوكيل",
    "admin.agentCreated": "تم إنشاء الوكيل",
    "admin.agentDeleted": "تم حذف الوكيل",
    "admin.noAgents": "لا يوجد وكلاء بعد. أنشئ واحدًا للبدء.",
    "admin.missingFields": "حقول مفقودة",
    "admin.missingFieldsDesc": "الاسم ونقطة النهاية مطلوبان.",
    "admin.namePlaceholder": "اسم الوكيل",
    "admin.categoryPlaceholder": "مثال: التحليلات",
    "admin.endpointPlaceholder": "https://api.example.com/agents/...",
    "admin.descriptionPlaceholder": "ماذا يفعل هذا الوكيل؟",
    "admin.assignmentNote": "تعيين المستخدم",
    "admin.assignmentNoteDesc": "تعيين عبر البريد الإلكتروني قريبًا.",
    "auth.signIn": "تسجيل الدخول",
    "auth.signUp": "إنشاء حساب",
    "auth.signOut": "تسجيل الخروج",
    "auth.signInDesc": "مرحبًا بك في مركز قيادة الذكاء الاصطناعي",
    "auth.signUpDesc": "أنشئ حسابك للبدء",
    "auth.email": "البريد الإلكتروني",
    "auth.password": "كلمة المرور",
    "auth.displayName": "اسم العرض",
    "auth.noAccount": "ليس لديك حساب؟ سجل الآن",
    "auth.hasAccount": "لديك حساب بالفعل؟ سجل الدخول",
    "auth.error": "خطأ في المصادقة",
    "auth.checkEmail": "تحقق من بريدك الإلكتروني",
    "auth.checkEmailDesc": "أرسلنا لك رابط تأكيد.",
    "profile.title": "الملف الشخصي",
    "profile.subtitle": "إدارة معلوماتك الشخصية",
    "profile.displayName": "اسم العرض",
    "profile.bio": "السيرة الذاتية",
    "profile.save": "حفظ التغييرات",
    "profile.saved": "تم حفظ الملف الشخصي",
    "profile.saveError": "فشل في حفظ الملف الشخصي",
    "profile.uploadError": "فشل في تحميل الصورة",
    "settings.title": "الإعدادات",
    "settings.subtitle": "تكوين تفضيلاتك",
    "settings.language": "اللغة",
    "settings.theme": "المظهر",
    "settings.notifications": "الإشعارات",
    "settings.notificationsDesc": "تلقي إشعارات البريد الإلكتروني",
    "settings.saved": "تم حفظ الإعدادات",
    "chat.placeholder": "اكتب رسالتك...",
    "chat.welcome": "مرحبًا! أنا **{name}**. كيف يمكنني مساعدتك؟",
    "chat.simulated": 'لقد تلقيت استفسارك: "{query}". هذا رد محاكاة.',
    "chat.thinking": "أفكر...",
    "chat.voiceMessage": "رسالة صوتية",
    "chat.recording": "جاري التسجيل...",
    "chat.uploadImage": "تحميل صورة",
    "chat.uploadFile": "إرفاق ملف",
    "chat.voiceRecord": "تسجيل صوت",
    "notfound.title": "404",
    "notfound.text": "عفوًا! الصفحة غير موجودة",
    "notfound.link": "العودة إلى الرئيسية",
    "user.name": "المستخدم",
    "user.email": "user@company.com",
  },
  es: {
    "nav.agents": "Agentes",
    "nav.admin": "Admin",
    "nav.profile": "Perfil",
    "nav.settings": "Configuración",
    "app.title": "Portal de Agentes",
    "app.subtitle": "Centro de Comando IA",
    "agents.title": "Tus Agentes",
    "agents.subtitle": "Selecciona un especialista para iniciar una conversación",
    "agents.search": "Buscar agentes...",
    "agents.noResults": "No se encontraron agentes que coincidan con",
    "agents.noAgents": "No hay agentes disponibles. Pide a un admin que te asigne agentes.",
    "agents.online": "En línea",
    "agents.offline": "Desconectado",
    "agents.maintenance": "Mantenimiento",
    "admin.title": "Panel de Admin",
    "admin.subtitle": "Gestionar agentes, endpoints y control de acceso",
    "admin.newAgent": "Nuevo Agente",
    "admin.editAgent": "Editar Agente",
    "admin.createAgent": "Crear Nuevo Agente",
    "admin.name": "Nombre",
    "admin.category": "Categoría",
    "admin.endpoint": "URL del Endpoint",
    "admin.description": "Descripción",
    "admin.icon": "Icono",
    "admin.status": "Estado",
    "admin.actions": "Acciones",
    "admin.agent": "Agente",
    "admin.save": "Actualizar",
    "admin.create": "Crear",
    "admin.cancel": "Cancelar",
    "admin.agentUpdated": "Agente actualizado",
    "admin.agentCreated": "Agente creado",
    "admin.agentDeleted": "Agente eliminado",
    "admin.noAgents": "Sin agentes aún. Crea uno para empezar.",
    "admin.missingFields": "Campos faltantes",
    "admin.missingFieldsDesc": "El nombre y el endpoint son obligatorios.",
    "admin.namePlaceholder": "Nombre del agente",
    "admin.categoryPlaceholder": "ej. Analítica",
    "admin.endpointPlaceholder": "https://api.example.com/agents/...",
    "admin.descriptionPlaceholder": "¿Qué hace este agente?",
    "admin.assignmentNote": "Asignación de usuario",
    "admin.assignmentNoteDesc": "Asignación por email próximamente.",
    "auth.signIn": "Iniciar Sesión",
    "auth.signUp": "Registrarse",
    "auth.signOut": "Cerrar Sesión",
    "auth.signInDesc": "Bienvenido al Centro de Comando IA",
    "auth.signUpDesc": "Crea tu cuenta para empezar",
    "auth.email": "Correo electrónico",
    "auth.password": "Contraseña",
    "auth.displayName": "Nombre para mostrar",
    "auth.noAccount": "¿No tienes cuenta? Regístrate",
    "auth.hasAccount": "¿Ya tienes cuenta? Inicia sesión",
    "auth.error": "Error de autenticación",
    "auth.checkEmail": "Revisa tu email",
    "auth.checkEmailDesc": "Te enviamos un enlace de confirmación.",
    "profile.title": "Perfil",
    "profile.subtitle": "Gestiona tu información personal",
    "profile.displayName": "Nombre para mostrar",
    "profile.bio": "Bio",
    "profile.save": "Guardar Cambios",
    "profile.saved": "Perfil guardado",
    "profile.saveError": "Error al guardar perfil",
    "profile.uploadError": "Error al subir avatar",
    "settings.title": "Configuración",
    "settings.subtitle": "Configura tus preferencias",
    "settings.language": "Idioma",
    "settings.theme": "Tema",
    "settings.notifications": "Notificaciones",
    "settings.notificationsDesc": "Recibir notificaciones por email",
    "settings.saved": "Configuración guardada",
    "chat.placeholder": "Escribe tu mensaje...",
    "chat.welcome": "¡Hola! Soy **{name}**. ¿En qué puedo ayudarte?",
    "chat.simulated": 'He recibido tu consulta: "{query}". Esta es una respuesta simulada.',
    "chat.thinking": "Pensando...",
    "chat.voiceMessage": "Mensaje de voz",
    "chat.recording": "Grabando...",
    "chat.uploadImage": "Subir imagen",
    "chat.uploadFile": "Adjuntar archivo",
    "chat.voiceRecord": "Grabar voz",
    "notfound.title": "404",
    "notfound.text": "¡Ups! Página no encontrada",
    "notfound.link": "Volver al Inicio",
    "user.name": "Usuario",
    "user.email": "usuario@empresa.com",
  },
};

interface I18nContextType {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string, params?: Record<string, string>) => string;
  dir: "ltr" | "rtl";
}

const I18nContext = createContext<I18nContextType>({
  language: "en",
  setLanguage: () => {},
  t: (key) => key,
  dir: "ltr",
});

export function I18nProvider({ children }: { children: ReactNode }) {
  const [language, setLanguageState] = useState<Language>(() => {
    const stored = localStorage.getItem("app-language");
    return (stored as Language) || "en";
  });

  const setLanguage = useCallback((lang: Language) => {
    setLanguageState(lang);
    localStorage.setItem("app-language", lang);
    const langConfig = LANGUAGES.find((l) => l.code === lang);
    document.documentElement.dir = langConfig?.dir || "ltr";
    document.documentElement.lang = lang;
  }, []);

  const t = useCallback(
    (key: string, params?: Record<string, string>) => {
      let value = translations[language]?.[key] || translations.en[key] || key;
      if (params) {
        Object.entries(params).forEach(([k, v]) => {
          value = value.replace(`{${k}}`, v);
        });
      }
      return value;
    },
    [language]
  );

  const dir = LANGUAGES.find((l) => l.code === language)?.dir || "ltr";

  return (
    <I18nContext.Provider value={{ language, setLanguage, t, dir }}>
      {children}
    </I18nContext.Provider>
  );
}

export const useI18n = () => useContext(I18nContext);
